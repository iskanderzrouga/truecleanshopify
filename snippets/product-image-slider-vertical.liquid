{%- assign slider_id = section.id | default: 'default' -%}
<div class="product-thumbnail-slider">
  <div id="product-main-slider-{{ slider_id }}" class="splide product-main-slider" style="margin-bottom: 12px;">
    <div class="splide__track">
      <ul class="splide__list">
        {% for media in product.media %}
          {% if media.media_type == 'image' %}
            {% if media.alt contains 'carousel-hidden' %}
            {% else %}
              <li class="splide__slide">
                {% if section.settings.above_fold %}
                  {{ media.src | image_url: width: 600 | image_tag: class: '', preload: true }}
                {% else %}
                  {{ media.src | image_url: width: 600 | image_tag: class: '' }}
                {% endif %}
              </li>
            {% endif %}
          {% elsif media.media_type == 'video' %}
            <li class="splide__slide">
              <div class="product-image-slider__video-wrapper">
                {% render 'product-thumbnail-2',
                  media: media,
                  media_count: 0,
                  position: 1,
                  desktop_layout: 'thumbnail_slider',
                  mobile_layout: 'show',
                  loop: false,
                  modal_id: section.id,
                  xr_button: true,
                  media_width: media_width,
                  media_fit: 'cover',
                  constrain_to_viewport: true,
                  lazy_load: false
                %}
              </div>
            </li>
          {% endif %}
        {% endfor %}
      </ul>
    </div>
  </div>

  <div id="product-thumbnail-slider-{{ slider_id }}" class="splide product-thumbnail-slider-nav">
    <div class="splide__track">
      <ul class="splide__list">
        {% for media in product.media %}
          {% if media.media_type == 'image' %}
            {% if media.alt contains 'carousel-hidden' %}
            {% else %}
              <li class="splide__slide">
                {% if section.settings.above_fold %}
                  {{ media.src | image_url: width: 90 | image_tag: class: '', preload: true }}
                {% else %}
                  {{ media.src | image_url: width: 90 | image_tag: class: '' }}
                {% endif %}
              </li>
            {% endif %}
          {% elsif media.media_type == 'video' %}
            {% comment %}
              <video class="w-full" muted>
                <source src="{{ media.sources[0].url }}" type="video/mp4">
              </video>
            {% endcomment %}
            <li class="splide__slide">
              {% if section.settings.above_fold %}
                {{ media.preview_image | image_url: width: 90 | image_tag: class: '', preload: true }}
              {% else %}
                {{ media.preview_image | image_url: width: 90 | image_tag: class: '' }}
              {% endif %}
            </li>
          {% endif %}
        {% endfor %}
      </ul>
    </div>
  </div>
</div>

<style>
  .product-thumbnail-slider {
    display: flex;
    flex-direction: row-reverse;
    gap: 15px;
    position: sticky;
    top: 20px;
  }

  .product-thumbnail-slider-nav {
    padding: 40px 0;
  }
  .product-thumbnail-slider-nav .splide__track--nav > .splide__list > .splide__slide {
    border: 2px solid #084c2533;
    border-radius: 10px;
  }
  .product-thumbnail-slider-nav .splide__track--nav > .splide__list > .splide__slide.is-active {
    border: 2px solid #000c38;
  }
  .product-thumbnail-slider-nav .splide__arrow {
    width: 20px;
    height: 20px;
    background: transparent;
    border: 1px solid #000c38;
  }
  .product-thumbnail-slider-nav .splide__arrow svg {
    fill: #000c38;
    height: 10px;
    width: 10px;
  }

  .product-main-slider .splide__arrow {
    background: unset;
    width: 48px;
    height: 48px;
    background-color: #001c19;
    opacity: 1;
  }
  .product-main-slider .splide__arrow svg {
    fill: #fff;
    height: 22px;
    width: 22px;
  }
  .product-main-slider .splide__slide img {
    width: 100%;
    aspect-ratio: 1 / 1;
    object-fit: cover;
    height: 100%;
    background-color: #fff;
    border-radius: 20px;
  }

  .product-image-slider__video-wrapper .product-media-container {
    --ratio: 1 !important;
    --preview-ratio: 1 !important;
  }
  .product-image-slider__video-wrapper .product-media-container video {
    object-fit: cover;
    object-position: center;
  }

  @media screen and (max-width: 750px) {
    .product-main-slider .splide__slide img {
      border-radius: 0;
      max-height: 420px;
      width: auto;
      margin: 0 auto;
    }
    .product-thumbnail-slider {
      display: block;
    }
    .product-thumbnail-slider-nav {
      padding: 0 40px;
    }
    .product-thumbnail-slider-nav .splide__track {
      display: flex;
      justify-content: center;
    }
    .product-thumbnail-slider-nav .splide__list {
      justify-content: center;
    }
    /* .product-image-slider__video-wrapper .product-media-container video {
      height: calc(100% - 120px)!important;
    }
    .product-image-slider__video-wrapper .product-media-container .deferred-media__poster, 
    .product-image-slider__video-wrapper .product-media-container .deferred-media__poster img {
      height: calc(100% - 120px)!important;
    } */
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    var mainEl = document.querySelector('#MainProduct-{{ section.id }} #product-main-slider-{{ slider_id }}');
    var thumbEl = document.querySelector('#MainProduct-{{ section.id }} #product-thumbnail-slider-{{ slider_id }}');

    if (!mainEl || !thumbEl) return;

    var main = new Splide(mainEl, {
      type: 'slide',
      rewind: true,
      pagination: false,
      arrows: true,
      breakpoints: {
        750: {
          arrows: true,
        },
      },
    });

    var thumbnails = new Splide(thumbEl, {
      fixedWidth: 90,
      fixedHeight: 90,
      gap: 10,
      rewind: true,
      pagination: false,
      arrows: false,
      cover: true,
      isNavigation: true,
      direction: 'ttb',
      height: 455,
      breakpoints: {
        750: {
          fixedWidth: 60,
          fixedHeight: 60,
          gap: 4,
          direction: 'ltr',
        },
      },
    });

    main.sync(thumbnails);
    main.mount();
    thumbnails.mount();
  });
</script>
