{% comment %}
  Renders product variant options
{% endcomment %}
{%- liquid
  assign product_form_id = 'product-form-' | append: section.id
-%}

<div class="max-w-[400px] mx-auto flex flex-col gap-2">
{%- for value in option.values -%}
  {%- liquid
    assign option_disabled = true
    if value.available
      assign option_disabled = false
    endif
  -%}

  {%- capture input_id -%}
    {{ section.id }}-{{ option.position }}-{{ forloop.index0 -}}
  {%- endcapture -%}

  {%- capture input_name -%}
    {{ option.name }}-{{ option.position }}
  {%- endcapture -%}

  {% assign forloop_index = forloop.index | times: 2 | minus: 1 %}
  {% assign variant = product.variants[forloop_index] %}
  {% assign sub_percent = variant.metafields.custom.subscription_discount | plus: 0 | divided_by: 100.000 %}
  {% assign inverted_percent = 1 | minus: sub_percent %}
  {% assign variant_count = variant.metafields.custom.count | default: 1 %}

  <div class="product-variant--{{forloop.index}}">
    <input
      type="radio"
      class="new-lp-variant--inut-sub hidden"
      id="{{ input_id }}"
      name="{{ input_name | escape }}"
      value="{{ value | escape }}"
      form="{{ product_form_id }}"
      {% if value.selected %}checked{% endif %}
      {% if option_disabled %}disabled{% endif %}
      data-product-url="{{ value.product_url }}"
      data-option-value-id="{{ value.id }}"
    >

    <label
      for="{{ input_id }}"
      {% if variant.metafields.custom.subscription_id != blank %}data-subscription-id="{{ variant.metafields.custom.subscription_id }}"{% endif %}
      data-total-price="{{ variant.price | times: inverted_percent | money_without_trailing_zeros }}"
      data-total-price-onetime="{{ variant.price | money_without_trailing_zeros }}"
      class="new-lp-variant--label-sub block cursor-pointer"
    >
      <div class="new-lp-variant-content flex items-center justify-between gap-3 border border-[#E0E0E0] bg-white rounded-lg p-3 transition-all duration-200 hover:border-[#00B7A2]">

        <!-- Radio + Title -->
        <div class="flex items-center gap-3">
          <div class="new-lp-variant-radio w-5 h-5 min-w-5 border-2 border-[#ccc] rounded-full flex items-center justify-center">
            <div class="new-lp-variant-radio__circle w-2.5 h-2.5 rounded-full bg-[#00B7A2] hidden"></div>
          </div>
          <span class="text-[16px] md:text-[17px] font-semibold text-[#001C19]">
            {{ value }}
          </span>
        </div>

        <!-- 3 Months Supply Badge + Price -->
        <div class="flex items-center gap-3">
          <span class="text-white font-bold text-[10px] md:text-[11px] bg-[#00B7A2] leading-tight px-2 py-1 rounded uppercase tracking-wide whitespace-nowrap">
            3 Mo Supply
          </span>
          <span class="text-[18px] md:text-[20px] font-bold text-[#001C19]">
            <span class="onetimecard-element">
              {{- variant.price | divided_by: variant_count | money_without_trailing_zeros -}}{% if variant_count > 1 %}/ea{% endif %}
            </span>
            <span class="subscription-element">
              {{- variant.price | times: inverted_percent | divided_by: variant_count | money_without_trailing_zeros -}}{% if variant_count > 1 %}/ea{% endif %}
            </span>
          </span>
        </div>

      </div>
    </label>
  </div>
{%- endfor -%}
</div>

<script>
(function() {
  const inputs = document.querySelectorAll('.new-lp-variant--inut-sub');
  const totalDisplay = document.querySelector('.tc-total-price');

  function updateTotal() {
    const checked = document.querySelector('.new-lp-variant--inut-sub:checked');
    if (checked && totalDisplay) {
      const label = checked.closest('.product-variant--1, .product-variant--2, .product-variant--3, .product-variant--4')?.querySelector('label');
      if (label) {
        const isSubscription = document.querySelector('#productsVariants')?.classList.contains('show-subscription');
        const price = isSubscription !== false ? label.dataset.totalPrice : label.dataset.totalPriceOnetime;
        totalDisplay.textContent = price;
      }
    }
  }

  inputs.forEach(input => input.addEventListener('change', updateTotal));
  updateTotal();
})();
</script>
